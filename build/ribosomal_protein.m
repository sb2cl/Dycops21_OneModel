classdef ribosomal_protein
	% This file was automatically generated by OneModel.
	% Any changes you make to it will be overwritten the next time
	% the file is generated.

	properties
		p      % Default model parameters.
		x0     % Default initial conditions.
		M      % Mass matrix for DAE systems.
		opts   % Simulation options.
	end

	methods
		function obj = ribosomal_protein()
			%% Constructor of ribosomal_protein.
			obj.p    = obj.default_parameters();
			obj.x0   = obj.initial_conditions();
			obj.M    = obj.mass_matrix();
			obj.opts = obj.simulation_options();
		end

		function p = default_parameters(~)
			%% Default parameters value.
			p = [];
			p.ribo__N = 55.0;
			p.ribo__omega = 7.33;
			p.ribo__d_m = 0.16;
			p.ribo__k_b = 4.7627;
			p.ribo__k_u = 119.7956;
			p.ribo__l_p = 195.0;
			p.ribo__l_e = 25.0;
			p.ribo__weigth = 0.0045;
		end

		function x0 = initial_conditions(~)
			%% Default initial conditions.
			x0 = [
				100.0 % ribo__m
			];
		end

		function M = mass_matrix(~)
			%% Mass matrix for DAE systems.
			M = [
				1 
			];
		end

		function opts = simulation_options(~)
			%% Default simulation options.
			opts.t_end = 10.0;
			opts.t_init = 0.0;
		end

		function dx = ode(~,t,x,p)
			%% Evaluate the ODE.
			%
			% Args:
			%	 t Current time in the simulation.
			%	 x Array with the state value.
			%	 p Struct with the parameters.
			%
			% Return:
			%	 dx Array with the ODE.

			% ODE and algebraic states:
			ribo__m = x(1,:);

			% Assigment states:
			ribo__nu = 1;
			ribo__mu = 1;
			ribo__r = 1;
			ribo__m_h = 1;
			ribo__J_host_sum = 1;
			ribo__K_C0 = p.ribo__k_b./(p.ribo__k_u + ribo__nu./p.ribo__l_e);
			ribo__E_m = 3.459;
			ribo__J = ribo__E_m.*p.ribo__omega./(p.ribo__d_m./ribo__K_C0 + ribo__mu.*ribo__r);
			ribo__r_t = ribo__m./p.ribo__weigth;

			% der(ribo__m)
			dx(1,1) = (ribo__m_h.*p.ribo__N.*ribo__J./ribo__J_host_sum - ribo__m).*ribo__mu;

		end
		function out = simout2struct(~,t,x,p)
			%% Convert the simulation output into an easy-to-use struct.

			% We need to transpose state matrix.
			x = x';
			% ODE and algebraic states:
			ribo__m = x(1,:);

			% Assigment states:
			ribo__nu = 1;
			ribo__mu = 1;
			ribo__r = 1;
			ribo__m_h = 1;
			ribo__J_host_sum = 1;
			ribo__K_C0 = p.ribo__k_b./(p.ribo__k_u + ribo__nu./p.ribo__l_e);
			ribo__E_m = 3.459;
			ribo__J = ribo__E_m.*p.ribo__omega./(p.ribo__d_m./ribo__K_C0 + ribo__mu.*ribo__r);
			ribo__r_t = ribo__m./p.ribo__weigth;

			% Save simulation time.
			out.t = t;

			% Vector for extending single-value states and parameters.
			ones_t = ones(size(t'));


			% Save states.
			out.ribo__nu = ribo__nu.*ones_t;
			out.ribo__mu = ribo__mu.*ones_t;
			out.ribo__r = ribo__r.*ones_t;
			out.ribo__m_h = ribo__m_h.*ones_t;
			out.ribo__J_host_sum = ribo__J_host_sum.*ones_t;
			out.ribo__K_C0 = ribo__K_C0.*ones_t;
			out.ribo__E_m = ribo__E_m.*ones_t;
			out.ribo__J = ribo__J.*ones_t;
			out.ribo__m = ribo__m.*ones_t;
			out.ribo__r_t = ribo__r_t.*ones_t;

			% Save parameters.
			out.ribo__N = p.ribo__N.*ones_t;
			out.ribo__omega = p.ribo__omega.*ones_t;
			out.ribo__d_m = p.ribo__d_m.*ones_t;
			out.ribo__k_b = p.ribo__k_b.*ones_t;
			out.ribo__k_u = p.ribo__k_u.*ones_t;
			out.ribo__l_p = p.ribo__l_p.*ones_t;
			out.ribo__l_e = p.ribo__l_e.*ones_t;
			out.ribo__weigth = p.ribo__weigth.*ones_t;

		end
		function plot(~,out)
			%% Plot simulation result.
			figure('Name','ribo');
			subplot(4,3,1);
			plot(out.t, out.ribo__nu);
			title("ribo__nu");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,2);
			plot(out.t, out.ribo__mu);
			title("ribo__mu");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,3);
			plot(out.t, out.ribo__r);
			title("ribo__r");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,4);
			plot(out.t, out.ribo__m_h);
			title("ribo__m_h");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,5);
			plot(out.t, out.ribo__J_host_sum);
			title("ribo__J_host_sum");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,6);
			plot(out.t, out.ribo__K_C0);
			title("ribo__K_C0");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,7);
			plot(out.t, out.ribo__E_m);
			title("ribo__E_m");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,8);
			plot(out.t, out.ribo__J);
			title("ribo__J");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,9);
			plot(out.t, out.ribo__m);
			title("ribo__m");
			ylim([0, +inf]);
			grid on;

			subplot(4,3,10);
			plot(out.t, out.ribo__r_t);
			title("ribo__r_t");
			ylim([0, +inf]);
			grid on;

		end
	end
end
